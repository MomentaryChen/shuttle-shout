# Feature Specification: 人員羽球等級制度

**Feature Branch**: `003-personnel-badminton-level`  
**Created**: 2025-02-13  
**Status**: Draft  
**Input**: User description: "幫我將人員加入等級 請依照羽球等級參考表建立等級制度 等級預設null"

## Clarifications

### Session 2025-02-13

- Q: 人員等級的「儲存值」與「介面顯示」要採用哪一種？（級數 1–18 vs 比賽階級 7 檔） → A: 後端儲存級數（1–18），前端主要顯示比賽階級與級數（兩者皆可呈現）。
- Q: 參考表中各級數的「程度說明」是否要在系統中呈現？ → A: 不呈現；系統只顯示比賽階級與級數，程度說明僅作內部或文件參考。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 人員具備羽球等級欄位且預設為未設定 (Priority: P1)

管理員或具權限者查看或編輯人員資料時，可看到該人員的「羽球等級」。新建立或既有尚未設定等級的人員，其等級為「未設定」（對應儲存為 null），不影響既有資料與流程。

**Why this priority**: 等級欄位與預設值是功能基礎，沒有此項就無法區分「有等級」與「未設定」。

**Independent Test**: 查詢任意人員資料，確認存在等級欄位；新增人員或將既有人員等級清空後，確認等級顯示為未設定且查詢結果為 null。

**Acceptance Scenarios**:

1. **Given** 系統已啟用人員等級功能，**When** 查詢任一人員資料，**Then** 回傳資料包含等級欄位，且未設定時為 null（或對應之「未設定」顯示）。
2. **Given** 新增一名人員，**When** 未指定等級即儲存，**Then** 該人員的等級為 null（前端顯示為未設定）。
3. **Given** 已有等級的人員，**When** 管理員將等級改為「未設定」並儲存，**Then** 該人員的等級儲存為 null。

---

### User Story 2 - 依羽球等級參考表設定與顯示人員等級 (Priority: P2)

系統提供依「羽球等級參考表」定義的等級選項。具權限者可在人員的新增/編輯流程中為人員選擇一個等級；列表與詳情頁可正確顯示該等級名稱。

**Why this priority**: 等級制度需與業務認可的參考表一致，才能用於分級、配對或統計。

**Independent Test**: 在人員編輯畫面選擇參考表中的任一等級並儲存，重新查詢後確認顯示與儲存一致；列表篩選或排序依等級時結果正確。

**Acceptance Scenarios**:

1. **Given** 羽球等級參考表已定義多個等級，**When** 管理員在人員編輯畫面選擇某一等級並儲存，**Then** 後端儲存級數（1–18），前端在詳情與列表中顯示該級數及對應之比賽階級。
2. **Given** 人員列表畫面，**When** 使用者查看列表，**Then** 每人顯示的等級與其儲存值一致，未設定時顯示為「未設定」或等同說明。
3. **Given** 具備等級篩選或排序功能時，**When** 使用者依等級篩選或排序，**Then** 結果僅包含符合條件的人員且順序正確。

---

### User Story 3 - 等級參考表可維護且不影響既有資料 (Priority: P3)

若系統支援等級參考表的維護（新增/停用/更名等級），變更參考表時，已儲存的人員等級若仍對應有效等級則不受影響；若對應到已停用或移除的等級，需有明確的顯示與處理策略（例如顯示為「原等級名稱（已停用）」或視為未設定）。

**Why this priority**: 確保參考表演進時既有資料可解讀、不遺失。

**Independent Test**: 若有參考表維護功能，變更參考表後查詢曾使用該等級的人員，確認顯示與查詢行為符合上述策略。

**Acceptance Scenarios**:

1. **Given** 人員 A 的等級為參考表中的「甲」，**When** 參考表未變更，**Then** 人員 A 的等級持續顯示為「甲」。
2. **Given** 參考表中等級「乙」被停用或移除，**When** 查詢等級為「乙」的人員，**Then** 系統以預定策略顯示（如顯示原名稱並標註已停用，或視為未設定），且不造成錯誤。

---

### Edge Cases

- 人員匯入或批次更新時未提供等級欄位：應視為未設定，儲存為 null。
- 歷史資料遷移：既有人員無等級欄位時，遷移後等級應為 null。
- 羽球等級參考表尚未定義或為空：僅允許等級為「未設定」（null），直到參考表有至少一筆有效等級可選。
- 程度說明：參考表內各級數的程度說明不在系統介面呈現，僅作內部或文件參考。
- 權限不足的使用者：僅能查看等級時不得修改；無權限時不得看到敏感人員資料（依既有權限模型）。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須為「人員」實體提供「等級」屬性，用於表示該人員依羽球等級參考表所對應的等級；後端儲存值為**級數**（1–18），前端顯示時須同時呈現**比賽階級**與**級數**（例如「中階」「8」或「8 - 中階」）。
- **FR-002**: 等級的允許值必須完全依照「羽球等級參考表」定義（級數 1–18）；系統不得接受參考表以外的等級值。
- **FR-003**: 人員等級預設為 null（未設定）；新建立的人員與未指定等級的更新，其等級必須為 null。
- **FR-004**: 系統必須在人員的新增、編輯、列表與詳情等處，支援等級的顯示（比賽階級與級數）；不呈現各級數的「程度說明」，程度說明僅供內部或文件參考。未設定時必須以明確的「未設定」或等同方式呈現，不得顯示為空白或誤導。
- **FR-005**: 系統必須持久化人員等級；查詢人員時必須回傳等級欄位（值可為 null）。
- **FR-006**: 等級的設定與變更必須受既有權限模型控管；僅具備人員寫入權限的角色可新增或修改人員等級。
- **FR-007**: 既有人員在未經更新等級前，其等級必須視為 null（或經遷移腳本明確寫入 null），以保持行為一致。

### Key Entities

- **人員（User/Personnel）**：系統中的使用者/成員，具備基本資料；本功能為其新增「等級」屬性，儲存值為**級數**（1–18 或 null）。
- **羽球等級參考表**：依台灣羽球推廣協會分級制度，含**級數** 1–18 與對應之**比賽階級**（新手階、初階、初中階、中階、中進階、高階、職業級）；後端以級數儲存與驗證，前端顯示時同時呈現比賽階級與級數。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 所有人員查詢介面（列表、詳情、編輯表單）皆能顯示等級欄位，且未設定時 100% 顯示為「未設定」或等同說明，不出現未定義的空白或錯誤值。
- **SC-002**: 新建立的人員與將等級清空後的既有人員，其等級儲存值為 null 的比例為 100%。
- **SC-003**: 使用者能在 30 秒內在人員編輯流程中完成等級的選取與儲存，且儲存後再次進入畫面時顯示與選擇一致。
- **SC-004**: 等級選項與羽球等級參考表一致；系統拒絕參考表以外等級的寫入（若有 API 或表單送出），錯誤率 100% 被攔截並回饋明確訊息。

## Assumptions

- 羽球等級參考表採用台灣羽球推廣協會分級制度（級數 1–18、比賽階級 7 檔）；後端僅儲存級數，前端顯示比賽階級與級數。
- 人員與現有「用戶（User）」為同一概念；等級欄位加在現有人員/用戶實體上。
- 預設 null 表示「未設定」，與「未分級」同義，不影響登入、權限與既有流程。
- 列表的篩選、排序若需依等級，視為後續擴充，本規格以「可顯示等級」與「可寫入/查詢等級」為必要範圍。
